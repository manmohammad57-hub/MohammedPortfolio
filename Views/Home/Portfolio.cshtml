@model MohammedPortfolio.Models.ViewModels.ProjectViewModel
@{
    ViewData["Title"] = "Projects";
}

<!-- ============================
     PROJECTS SECTION
============================= -->
<section id="portfolio" class="portfolio section">
    <div class="container section-title" data-aos="fade-up">
        <h2>My Projects</h2>
        <p>@Model?.Bio?.Content</p>
    </div>

    <div class="container" data-aos="fade-up" data-aos-delay="100">
        <div class="isotope-layout" data-default-filter="*" data-layout="masonry" data-sort="original-order">

            <ul class="portfolio-filters isotope-filters text-center mb-4" data-aos="fade-up" data-aos-delay="200">
                <li data-filter="*" class="filter-active">All</li>
                @foreach (var category in Model.Categories)
                {
                    var cssFilter = "filter-" + category.CategoryName
                        .ToLower()
                        .Replace(" ", "-")
                        .Replace(".", "");
                    <li data-filter=".@cssFilter">@category.CategoryName</li>
                }
            </ul>

            <div class="row gy-4 isotope-container" data-aos="fade-up" data-aos-delay="300">
                @if (Model.Projects != null && Model.Projects.Any())
                {
                    foreach (var item in Model.Projects)
                    {
                        var categoryClass = "filter-" + (item.Category?.CategoryName?
                            .ToLower()
                            .Replace(" ", "-")
                            .Replace(".", ""));

                        <div class="col-lg-4 col-md-6 portfolio-item isotope-item @categoryClass">
                            <div class="portfolio-card shadow-sm rounded p-3">
                                <div class="portfolio-img mb-3">
                                    @if (item.Image != null && item.Image.Length > 0)
                                    {
                                        <img src="data:image/jpeg;base64,@Convert.ToBase64String(item.Image)" 
                                             alt="@item.Title" 
                                             class="img-fluid rounded" />
                                    }
                                    else
                                    {
                                        <img src="~/img/portfolio/default.webp" 
                                             alt="@item.Title" 
                                             class="img-fluid rounded" />
                                    }
                                </div>

                                <div class="portfolio-info mb-3 text-center">
                                    <h5>@item.Title</h5>
                                    <p>@item.Description</p>
                                    <small class="text-muted">@item.Category?.CategoryName</small>
                                </div>

                                <div class="portfolio-buttons d-flex justify-content-center gap-2">
                                    <a asp-controller="Home"
                                       asp-action="ProjectDetails"
                                       asp-route-id="@item.Id"
                                       class="btn btn-primary btn-sm">
                                        More Details
                                    </a>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <p class="text-center text-muted">No projects found.</p>
                }
            </div>
        </div>
    </div>
</section>

<script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const portfolioContainer = document.querySelector('.isotope-container');
        if (portfolioContainer) {
            const iso = new Isotope(portfolioContainer, {
                itemSelector: '.isotope-item',
                layoutMode: 'masonry'
            });

            const filters = document.querySelectorAll('.portfolio-filters li');
            filters.forEach(f => {
                f.addEventListener('click', function () {
                    filters.forEach(el => el.classList.remove('filter-active'));
                    this.classList.add('filter-active');
                    const filterValue = this.getAttribute('data-filter');
                    iso.arrange({ filter: filterValue });
                });
            });
        }
    });
</script>
